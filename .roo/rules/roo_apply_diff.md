# roo_rules for apply_diff

## apply_diff使用時の必須ルール

### 1. REPLACEセクションの内容制限
- **純粋なコードのみ**を含める
- 以下は絶対に含めない：
  - `:start_line:`、`:end_line:`などのメタデータ
  - `# 修正`、`# 変更`、`# 追加`などのコメント
  - 行番号
  - 説明文やドキュメント

### 2. 正しいフォーマット例

```git
<<<<<<< REPLACE
元のコードをそのまま正確にコピー
=======
新しいコードのみを記述
>>>>>>> REPLACE
```

### 3. 実行前チェックリスト
apply_diffを実行する前に必ず確認：
- [ ] REPLACEセクションに純粋なコードのみが含まれているか
- [ ] メタデータ（:start_line:など）が含まれていないか
- [ ] コメントや説明が混入していないか
- [ ] 実際のファイル内容と完全に一致しているか

### 4. 段階的適用の原則
- 大きな変更は小さな変更に分割する
- 一度に変更する範囲を最小限に抑える
- 各変更後に動作確認を行う

### 5. エラー時の対処
apply_diffでエラーが発生した場合：
1. 対象ファイルの現在の状態を再確認
2. 変更箇所を正確に特定し直す
3. 差分の形式を再検証
4. 必要に応じて変更を分割して再実行

### 6. 禁止パターン
以下のパターンをREPLACEセクションに含めてはいけない：
- `:start_line:`
- `:end_line:`
- `# 修正`
- `# 変更`
- `# 追加`
- `// 変更点`
- `/* コメント */`

### 7. 品質確保のための手順
1. 対象ファイルの存在確認
2. 変更対象行の存在確認
3. 差分の構文チェック
4. 変更内容の論理的整合性チェック
5. 適用後の検証

### 8. 重複適用防止ルール
apply_diffを実行する前に必ず：
- 対象ファイルの**現在の状態**を確認する
- 変更が既に適用されていないかチェックする
- 「Search and replace content are identical」エラーが発生した場合は、変更が既に適用済みであることを認識する

### 9. 現在状態確認の手順
1. ファイルの内容を最新の状態で確認
2. 過去の変更履歴を考慮
3. 変更が必要かどうかを判断
4. 必要な場合のみapply_diffを実行

## 重要な注意点
apply_diffは「純粋なコード置換ツール」であり、説明付きの差分ツールではありません。REPLACEセクションには実際のファイル内容と完全に一致するコードのみを記述してください。

**重複適用を防ぐため、apply_diff実行前には必ず対象ファイルの現在の状態を確認し、変更が既に適用されていないかチェックしてください。**